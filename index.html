<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FIRE-CORE v12.2 - MOBILE OPTIMIZED</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700&display=swap');
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            background-color: #020203; 
            font-family: 'Assistant', sans-serif; 
            color: #ececec; 
        }

        .app-wrapper {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* Header - Scaled for readability */
        header {
            flex: 0 0 60px;
            background: #0a0b0e;
            padding: 0 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 2px solid #ef4444;
            z-index: 1000;
        }

        .search-bar {
            display: flex;
            gap: 8px;
            flex: 1;
            max-width: 500px;
            margin: 0 10px;
        }

        input#addr-input {
            flex: 1;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #374151;
            background: #111827;
            color: #fff;
            font-size: 16px; /* Prevent iOS zoom on focus */
            outline: none;
            transition: all 0.2s;
        }

        input#addr-input:focus { border-color: #ef4444; box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.2); }

        .btn-search {
            padding: 10px 20px;
            background: #ef4444;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-weight: 700;
            cursor: pointer;
            font-size: 14px;
        }

        /* Main Workspace */
        main {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Information Sidebar */
        #info-sidebar {
            flex: 0 0 300px;
            background: #0a0b0e;
            border-left: 1px solid #1f2937;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            padding: 15px;
            z-index: 20;
        }

        .side-card {
            background: #111827;
            border: 1px solid #1f2937;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 12px;
        }

        .section-title { 
            color: #ef4444; 
            font-size: 12px; 
            font-weight: 800; 
            text-transform: uppercase; 
            letter-spacing: 0.05em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .data-row { font-size: 14px; line-height: 1.6; color: #d1d5db; margin-bottom: 6px; }
        .data-row b { color: #fff; }

        .alert-panel {
            background: rgba(245, 158, 11, 0.15);
            border: 1.5px solid #f59e0b;
            color: #f59e0b;
            padding: 12px;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 700;
        }

        /* Simulation Area */
        #canvas-wrap {
            flex: 1;
            background: radial-gradient(circle at 50% 50%, #111827 0%, #020203 100%);
            position: relative;
            z-index: 5;
        }

        /* Floating Street View Window - Improved for Mobile */
        #floating-sv {
            position: absolute;
            bottom: 25px;
            right: 25px;
            width: 350px;
            height: 200px;
            background: #000;
            border: 3px solid #374151;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0,0,0,0.7);
            display: none;
            z-index: 100;
        }

        #floating-sv iframe { width: 100%; height: 100%; border: none; }

        /* Mini-Map */
        #mini-map {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 120px;
            height: 120px;
            background: #000;
            border: 2px solid #ef4444;
            border-radius: 10px;
            z-index: 50;
            overflow: hidden;
            display: none;
            pointer-events: none;
        }

        #mini-map iframe { width: 100%; height: 100%; border: none; }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            header { flex: 0 0 70px; padding: 0 10px; }
            .btn-search { padding: 10px 12px; font-size: 13px; }
            
            main { flex-direction: column-reverse; }
            
            #info-sidebar { 
                flex: 0 0 50%; /* More space for readable text */
                width: 100%; 
                border-left: none; 
                border-top: 2px solid #ef4444;
                padding: 15px 10px;
            }

            .data-row { font-size: 15px; } /* Larger font for mobile */
            .section-title { font-size: 13px; }

            #floating-sv { 
                width: 180px; 
                height: 110px; 
                bottom: calc(50% + 20px); 
                right: 15px; 
                border-color: #ef4444;
                display: block; /* Ensure it stays visible */
            }
            
            #ori-container { 
                left: 15px; 
                bottom: calc(50% + 20px); 
                transform: scale(0.85); 
                transform-origin: bottom left;
            }

            #canvas-wrap { flex: 1; }
            .logo-text { display: none; }
        }

        /* ORI ASSISTANT */
        #ori-container {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        #ori-bubble {
            background: #fff;
            color: #111;
            padding: 12px 15px;
            border-radius: 18px;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 12px;
            position: relative;
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            border: 2px solid #ef4444;
            pointer-events: auto;
            width: 250px;
        }

        #ori-bubble::after {
            content: ''; position: absolute; bottom: -12px; left: 50%;
            transform: translateX(-50%);
            border-left: 12px solid transparent; border-right: 12px solid transparent; border-top: 12px solid #ef4444;
        }

        #ori-quick-input {
            width: 100%; margin-top: 8px; padding: 8px;
            border-radius: 10px; border: 1px solid #d1d5db;
            font-size: 13px; outline: none; background: #f9fafb;
        }

        #ori-avatar {
            width: 65px; height: 65px;
            background: #fff;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.4);
            cursor: pointer; border: 3px solid #ef4444;
            overflow: hidden; pointer-events: auto;
        }

        #ori-avatar svg { width: 85%; height: 85%; }

        /* Welcome Overlay */
        #welcome-screen {
            position: absolute; inset: 0; background: #020203; z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
            padding: 25px;
        }

        .quick-addresses { margin-top: 25px; display: grid; gap: 12px; width: 100%; max-width: 400px; }
        .addr-btn { 
            background: #111827; border: 1px solid #1f2937; color: #fff; 
            padding: 18px; border-radius: 12px; cursor: pointer; font-size: 16px; 
            transition: 0.2s; text-align: center; font-weight: 600;
        }
        .addr-btn:hover { border-color: #ef4444; background: #1f2937; }

        #loading-screen {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95); padding: 35px; border-radius: 20px;
            z-index: 200; display: none; color: #ef4444; font-weight: 800; border: 2px solid #ef4444; text-align: center;
        }

        .legend-dot { width: 10px; height: 10px; margin-left: 10px; border-radius: 3px; flex-shrink: 0; }
    </style>
    <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.150.1/examples/jsm/"
        }
      }
    </script>
</head>
<body>

    <div class="app-wrapper">
        <header>
            <div class="logo-text" style="color: #ef4444; font-weight: 800; font-size: 20px; display: flex; align-items: center; gap: 10px;">
                <span>ğŸš’</span> FIRE-CORE PRO
            </div>
            <div class="search-bar">
                <input id="addr-input" type="text" placeholder="×”×§×œ×“ ×›×ª×•×‘×ª..." autofocus />
                <button id="search-btn" class="btn-search">××—×–×¨</button>
            </div>
        </header>

        <main>
            <!-- Welcome View -->
            <div id="welcome-screen">
                <div style="font-size: 70px; margin-bottom: 20px; filter: drop-shadow(0 0 15px #ef4444);">ğŸ›¡ï¸</div>
                <h2 style="font-size: 28px; margin: 0; letter-spacing: 0.5px;">××•×“×™×¢×™×Ÿ ××‘× ×™× ××‘×¦×¢×™</h2>
                <p style="color: #9ca3af; font-size: 16px; margin-top: 10px;">×‘×—×¨ ×›×ª×•×‘×ª ×œ×× ×œ×™×–×” ××™×™×“×™×ª:</p>
                <div class="quick-addresses">
                    <div class="addr-btn" onclick="quickSearch('×”×§×©×ª 3 × ×¡ ×¦×™×•× ×”')">ğŸ“ ×”×§×©×ª 3, × ×¡ ×¦×™×•× ×”</div>
                    <div class="addr-btn" onclick="quickSearch('×“×¨×š ×”×¤×¨×—×™× 9 ×’×“×¨×”')">ğŸ“ ×“×¨×š ×”×¤×¨×—×™× 9, ×’×“×¨×”</div>
                    <div class="addr-btn" onclick="quickSearch('×¢×•× ×•×ª ×”×©× ×” 5 × ×¡ ×¦×™×•× ×”')">ğŸ“ ×¢×•× ×•×ª ×”×©× ×” 5, × ×¡ ×¦×™×•× ×”</div>
                </div>
            </div>

            <div id="loading-screen">×× ×ª×— × ×ª×•× ×™ ×©×˜×— ×•×“×™×¨×•×ª...<br><small style="font-weight:400; opacity:0.7">×× × ×”××ª×Ÿ</small></div>

            <!-- Sidebar -->
            <aside id="info-sidebar">
                <h3 id="ui-title" style="margin:0 0 12px 0; color: #ef4444; font-size: 20px; border-bottom: 2px solid #1f2937; padding-bottom: 10px;">-</h3>
                
                <div class="section-title"><span>ğŸ“</span> ×’×™×©×” ××‘×¦×¢×™×ª</div>
                <div class="side-card">
                    <div class="data-row" id="ui-main-street">-</div>
                    <div class="data-row" id="ui-access">-</div>
                    <div class="data-row" id="ui-parking">-</div>
                </div>

                <div class="section-title"><span>ğŸ—ï¸</span> ××¤×¨×˜ ×”× ×“×¡×™ ×•×“×™×¨×•×ª</div>
                <div class="side-card">
                    <div class="data-row" id="ui-floors">-</div>
                    <div class="data-row" id="ui-garden">-</div>
                    <div class="data-row" id="ui-penthouse">-</div>
                    <div class="data-row" id="ui-infra">-</div>
                </div>

                <div class="section-title"><span>âš ï¸</span> ×”×ª×¨××•×ª ×§×¨×™×˜×™×•×ª</div>
                <div class="alert-panel" id="ui-alert">-</div>
                
                <div style="margin-top: 20px; font-size: 12px; color: #6b7280; padding-bottom: 20px;">
                    <div style="display:flex; align-items:center; margin-bottom:5px;"><div class="legend-dot" style="background:#ef4444"></div> ×œ×™×‘×ª ×‘×˜×•×Ÿ / ××“×¨×’×•×ª</div>
                    <div style="display:flex; align-items:center; margin-bottom:5px;"><div class="legend-dot" style="background:#10b981"></div> ×“×™×¨×•×ª ×’×Ÿ</div>
                    <div style="display:flex; align-items:center; margin-bottom:5px;"><div class="legend-dot" style="background:#f59e0b"></div> ×¤× ×˜×”××•×–×™×</div>
                </div>
            </aside>

            <div id="canvas-wrap">
                <div id="mini-map"></div>
                <div id="floating-sv"></div>
            </div>

            <!-- ORI ASSISTANT -->
            <div id="ori-container">
                <div id="ori-bubble">
                    <div class="bubble-text">×©×œ×•× ×× ×™ ××•×¨×™, ×¢×•×–×¨ ×•×§×”"× , ×œ×›×œ ×©××œ×” ×× ×™ ×œ×¨×©×•×ª×š..</div>
                    <input type="text" id="ori-quick-input" placeholder="×©××œ ×©××œ×”..." />
                </div>
                <div id="ori-avatar" onclick="toggleOri()">
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="100" cy="100" r="95" fill="#fff" stroke="#ef4444" stroke-width="4"/>
                        <rect x="50" y="50" width="100" height="70" rx="15" fill="#ef4444"/>
                        <rect x="65" y="65" width="70" height="30" rx="5" fill="#111827"/>
                        <circle cx="85" cy="80" r="6" fill="#00ffff"><animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/></circle>
                        <circle cx="115" cy="80" r="6" fill="#00ffff"><animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/></circle>
                        <path d="M70 120 L130 120 L120 170 L80 170 Z" fill="#ef4444"/>
                        <circle cx="100" cy="145" r="12" fill="#fbbf24"/>
                        <text x="100" y="150" font-size="8" text-anchor="middle" font-weight="bold" fill="#000">FIRE</text>
                    </svg>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls, model;
        let currentBuildingData = null;

        const database = {
            "×”×§×©×ª 3 × ×¡ ×¦×™×•× ×”": {
                name: "×”×§×©×ª 3, × ×¡ ×¦×™×•× ×”",
                mainStreet: "×¨×—×•×‘ ×”×©×¨×™×•×Ÿ",
                access: "××¨×—×•×‘ ×”×§×©×ª ×‘×œ×‘×“ (×¦×¨).",
                parking: "×§×•××ª ×¢××•×“×™× + ×—×¦×¨×•×ª.",
                floors: "4 ×§×•××•×ª ××¢×œ ×¢××•×“×™×.",
                garden: "2 ×“×™×¨×•×ª ×’×Ÿ (101, 102).",
                penthouse: "2 ×¤× ×˜×”××•×–×™× ×‘×§×•××” 4.",
                infra: "××™×: ×—×–×™×ª ×©×××œ. ×—×©××œ: ××¨×•×Ÿ ×™××™×Ÿ.",
                pop: "~35 ×“×™×™×¨×™×.",
                alert: "×¨×—×•×‘ ×œ×œ× ××•×¦×! ×× ×•×£ ×—×™×™×‘ ×œ×”×™×›× ×¡ ×œ××—×•×¨.",
                lat: 31.9269502, lng: 34.8121877,
                sv_embed: "https://www.google.com/maps/embed?pb=!4v1705658000000!6m8!1m7!1ss_umpcog4UlLmpx7U8wv_Q!2m2!1d31.9269502!2d34.8121877!3f322.76!4f11.59!5f0.78",
                cfg: { w: 18, d: 15, floors: 4, h: 3.2, 
                    units: [
                        {floor: 1, label: "101 ×’×Ÿ", type: 'garden', pos: [5, 4]},
                        {floor: 1, label: "102 ×’×Ÿ", type: 'garden', pos: [-5, 4]},
                        {floor: 4, label: "401 ×¤× ×˜'", type: 'penthouse', pos: [4, 0]},
                        {floor: 4, label: "402 ×¤× ×˜'", type: 'penthouse', pos: [-4, 0]}
                    ]
                }
            },
            "×“×¨×š ×”×¤×¨×—×™× 9 ×’×“×¨×”": {
                name: "×“×¨×š ×”×¤×¨×—×™× 9, ×’×“×¨×”",
                mainStreet: "×›×‘×™×© 40 / ×”×¨×¦×œ",
                access: "×›× ×™×¡×” ××“×¨×š ×”×¤×¨×—×™×.",
                parking: "×—× ×™×•×Ÿ ×ª×ª-×§×¨×§×¢×™ (××™× ×•×¡ 1).",
                floors: "8 ×§×•××•×ª ××¢×œ ×œ×•×‘×™.",
                garden: "4 ×“×™×¨×•×ª ×’×Ÿ (1, 2, 3, 4).",
                penthouse: "2 ×¤× ×˜×”××•×–×™× ×‘×§×•××” 8.",
                infra: "××™×: ×—×–×™×ª ×™××™×Ÿ. ×—×©××œ: ×¢×•×¨×£.",
                pop: "~105 ×“×™×™×¨×™×.",
                alert: "×—× ×™×•×Ÿ ×¤×¢×™×œ - ×¡×›× ×ª ×”×¦×˜×‘×¨×•×ª ×¢×©×Ÿ.",
                lat: 31.8123, lng: 34.7812,
                sv_embed: "https://www.google.com/maps/embed?pb=!4v1705658000000!6m8!1m7!1s-u_y5f4hO4vH7rG-S4_mOQ!2m2!1d31.8123!2d34.7812!3f180!4f10!5f0.78",
                cfg: { w: 22, d: 18, floors: 8, h: 3.1, 
                    units: [
                        {floor: 1, label: "×’×Ÿ 1", type: 'garden', pos: [7, 6]},
                        {floor: 8, label: "×¤× ×˜' 801", type: 'penthouse', pos: [6, 0]}
                    ]
                }
            }
        };

        function normalize(str) { return str.replace(/[ ,.\-]/g, '').trim(); }

        window.initThree = function() {
            if (renderer) return;
            const wrap = document.getElementById('canvas-wrap');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(35, wrap.clientWidth / wrap.clientHeight, 0.1, 2000);
            camera.position.set(120, 100, 120);

            const isMobile = window.innerWidth <= 768;
            renderer = new THREE.WebGLRenderer({ 
                antialias: !isMobile, 
                alpha: true, 
                powerPreference: isMobile ? 'low-power' : 'high-performance' 
            });
            
            renderer.setSize(wrap.clientWidth, wrap.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, isMobile ? 1.2 : 2));
            wrap.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            scene.add(new THREE.AmbientLight(0xffffff, 0.5));
            const sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(50, 150, 50);
            scene.add(sun);

            model = new THREE.Group();
            scene.add(model);
            animate();
        };

        function animate() {
            if (!renderer) return;
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function createLabel(text, pos, isUnit = false) {
            const isMobile = window.innerWidth <= 768;
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 300; canvas.height = 100;
            
            if(isUnit) {
                ctx.fillStyle = 'rgba(15, 23, 42, 0.95)';
                ctx.beginPath(); ctx.roundRect(5, 5, 280, 80, 15); ctx.fill();
                ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 3; ctx.stroke();
                ctx.fillStyle = '#fff'; ctx.font = `Bold ${isMobile ? '28px' : '22px'} Assistant`;
            } else {
                ctx.fillStyle = '#fff'; ctx.font = `Bold ${isMobile ? '32px' : '28px'} Assistant`;
            }
            
            ctx.textAlign = 'center';
            ctx.fillText(text, 150, 58);
            
            const texture = new THREE.CanvasTexture(canvas);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture, transparent: true }));
            sprite.position.set(pos[0], pos[1], pos[2]);
            sprite.scale.set(isUnit ? (isMobile ? 15 : 12) : (isMobile ? 22 : 18), isUnit ? (isMobile ? 5 : 4) : (isMobile ? 8 : 6), 1);
            return sprite;
        }

        function buildModel(data) {
            model.clear();
            const c = data.cfg;
            const tH = (c.floors + 1) * c.h;

            model.add(new THREE.GridHelper(500, 20, 0x1f2937, 0x0f172a));

            const core = new THREE.Mesh(
                new THREE.BoxGeometry(6, tH, 6),
                new THREE.MeshPhongMaterial({ color: 0xef4444, transparent: true, opacity: 0.7 })
            );
            core.position.y = tH / 2;
            model.add(core);

            for(let i=0; i<=c.floors; i++) {
                const floor = new THREE.Mesh(
                    new THREE.BoxGeometry(c.w, 0.1, c.d),
                    new THREE.MeshPhongMaterial({ color: 0x1e293b, transparent: true, opacity: 0.2 })
                );
                floor.position.y = i * c.h;
                model.add(floor);
                model.add(createLabel(`×§×•××” ${i}`, [c.w/2 + 12, i * c.h, 0]));
            }

            if(c.units) c.units.forEach(u => {
                let color = u.type === 'garden' ? 0x10b981 : (u.type === 'penthouse' ? 0xf59e0b : 0xffffff);
                const unitGeo = new THREE.BoxGeometry(c.w/2.6, c.h * 0.85, c.d/2.6);
                const unit = new THREE.Mesh(unitGeo, new THREE.MeshPhongMaterial({ color: color, transparent: true, opacity: 0.3 }));
                unit.position.set(u.pos[0], (u.floor * c.h) + (c.h/2), u.pos[1]);
                model.add(unit);
                const line = new THREE.LineSegments(new THREE.EdgesGeometry(unitGeo), new THREE.LineBasicMaterial({ color: color, opacity: 0.8 }));
                line.position.copy(unit.position); model.add(line);
                model.add(createLabel(u.label, [u.pos[0], (u.floor * c.h) + c.h + 1, u.pos[1]], true));
            });

            camera.position.set(c.w*3, tH*2.5, c.d*3);
            controls.target.set(0, tH/3, 0);
            controls.update();
        }

        window.quickSearch = function(addr) { 
            const input = document.getElementById('addr-input');
            input.value = addr;
            performSearch(); 
        };

        function performSearch() {
            const query = document.getElementById('addr-input').value.trim();
            if(!query) return;
            const welcome = document.getElementById('welcome-screen');
            const loader = document.getElementById('loading-screen');
            const sidebar = document.getElementById('info-sidebar');
            const miniMap = document.getElementById('mini-map');
            const sv = document.getElementById('floating-sv');
            
            welcome.style.display = 'none'; loader.style.display = 'block'; sidebar.style.display = 'none'; miniMap.style.display = 'none'; sv.style.display = 'none';

            const normQ = normalize(query);
            let data = null;
            for (let key in database) { if (normalize(key).includes(normQ) || normQ.includes(normalize(key))) { data = database[key]; break; } }

            if (!data) {
                data = { name: query, mainStreet: "×¦×™×¨ ×œ× ×™×“×•×¢", access: "×¡×¨×™×§×” ×‘×©×˜×—", parking: "×¡×¨×™×§×” ×‘×©×˜×—", floors: "?", garden: "?", penthouse: "?", infra: "××™×§×•× ×œ× ×™×“×•×¢", pop: "?", alert: "×‘×¦×¢ ×¡×¨×™×§×” ××œ××”", lat: 31.9, lng: 34.8, sv_embed: "", cfg: { w: 15, d: 12, floors: 5, h: 3, units: [] } };
            }

            setTimeout(() => {
                currentBuildingData = data;
                document.getElementById('ui-title').innerText = data.name;
                document.getElementById('ui-main-street').innerHTML = `<b>×¦×™×¨ ×”×’×¢×”:</b> ${data.mainStreet}`;
                document.getElementById('ui-access').innerHTML = `<b>×’×™×©×”:</b> ${data.access}`;
                document.getElementById('ui-parking').innerHTML = `<b>×—× ×™×™×”:</b> ${data.parking}`;
                document.getElementById('ui-floors').innerHTML = `<b>×§×•××•×ª:</b> ${data.floors}`;
                document.getElementById('ui-garden').innerHTML = `<b>×“×™×¨×•×ª ×’×Ÿ:</b> ${data.garden}`;
                document.getElementById('ui-penthouse').innerHTML = `<b>×¤× ×˜×”××•×–×™×:</b> ${data.penthouse}`;
                document.getElementById('ui-infra').innerHTML = `<b>×ª×©×ª×™×•×ª:</b> ${data.infra}`;
                document.getElementById('ui-alert').innerText = data.alert;

                miniMap.innerHTML = `<iframe src="https://maps.google.com/maps?q=${data.lat},${data.lng}&t=&z=17&ie=UTF8&iwloc=&output=embed" allowfullscreen></iframe>`;
                miniMap.style.display = 'block';

                sv.innerHTML = `<iframe src="${data.sv_embed || `https://www.google.com/maps?q=${encodeURIComponent(data.name)}&output=embed&layer=c`}" allowfullscreen></iframe>`;
                sv.style.display = 'block';

                if (!renderer) window.initThree();
                buildModel(data);
                loader.style.display = 'none'; sidebar.style.display = 'flex';
                onResize();
            }, 600);
        }

        document.getElementById('search-btn').onclick = performSearch;
        document.getElementById('addr-input').onkeypress = (e) => { if (e.key === 'Enter') performSearch(); };

        window.toggleOri = () => {
            const bubble = document.getElementById('ori-bubble');
            const current = bubble.style.display;
            bubble.style.display = (current === 'none') ? 'block' : 'none';
        };

        function onResize() {
            if (!renderer) return;
            const wrap = document.getElementById('canvas-wrap');
            camera.aspect = wrap.clientWidth / wrap.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(wrap.clientWidth, wrap.clientHeight);
        }
        window.addEventListener('resize', onResize);
        window.onload = () => { setTimeout(window.initThree, 200); };
    </script>
</body>
</html>
