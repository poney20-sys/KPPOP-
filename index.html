<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FIRE-CORE v15.0 - GLOBAL PRECISION ENGINE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;600;700;800&display=swap');
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; touch-action: manipulation; }
        
        body, html { 
            margin: 0; padding: 0; 
            width: 100%; height: 100%; 
            overflow: hidden; 
            background-color: #020408; 
            font-family: 'Assistant', sans-serif; 
            color: #f8fafc; 
        }

        .app-wrapper {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
        }

        /* Header - Optimized for Mobile */
        header {
            flex: 0 0 70px;
            background: #0f172a;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 4px solid #ef4444;
            z-index: 1000;
        }

        .logo-box {
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 800;
            font-size: 22px;
            color: #ef4444;
        }

        .search-bar {
            display: flex;
            gap: 10px;
            flex: 1;
            max-width: 500px;
            margin: 0 20px;
        }

        input#addr-input {
            flex: 1;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid #334155;
            background: #1e293b;
            color: #fff;
            font-size: 16px;
            outline: none;
        }

        .btn-search {
            padding: 12px 20px;
            background: #ef4444;
            color: #fff;
            border: none;
            border-radius: 12px;
            font-weight: 800;
            cursor: pointer;
            font-size: 14px;
        }

        main {
            flex: 1;
            display: flex;
            overflow: hidden;
            position: relative;
        }

        /* Information Sidebar */
        #info-sidebar {
            flex: 0 0 320px;
            background: #0f172a;
            border-left: 2px solid #1e293b;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            padding: 20px;
            z-index: 20;
        }

        .side-card {
            background: #1e293b;
            border-radius: 16px;
            padding: 18px;
            margin-bottom: 15px;
            border: 1px solid #334155;
        }

        .section-header { 
            color: #ef4444; 
            font-size: 13px; 
            font-weight: 800; 
            text-transform: uppercase; 
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 1px solid #334155;
            padding-bottom: 6px;
        }

        .data-point { font-size: 15px; line-height: 1.6; color: #f1f5f9; margin-bottom: 8px; }
        .data-point b { color: #ef4444; }

        .alert-box {
            background: rgba(245, 158, 11, 0.1);
            border: 2.5px solid #f59e0b;
            color: #fbbf24;
            padding: 18px;
            border-radius: 16px;
            font-size: 14px;
            font-weight: 800;
        }

        /* Visualization Layout */
        #viz-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            height: 100%;
        }

        #3d-view {
            flex: 1.2;
            position: relative;
            background: radial-gradient(circle at center, #1e293b 0%, #020408 100%);
        }

        #image-view {
            flex: 0.8; 
            background: #000;
            border-top: 4px solid #ef4444;
            position: relative;
        }

        #image-view iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        /* Overlay UI Components */
        #mini-map {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 120px;
            height: 120px;
            border: 2px solid #ef4444;
            border-radius: 12px;
            overflow: hidden;
            display: none;
            z-index: 50;
        }

        #mini-map iframe { width: 100%; height: 100%; border: none; }

        /* Mobile Optimization */
        @media (max-width: 768px) {
            header { flex: 0 0 120px; flex-direction: column; padding: 10px; }
            .search-bar { width: 100%; margin: 10px 0 0 0; }
            .logo-box { font-size: 18px; }

            main { flex-direction: column-reverse; }
            
            #info-sidebar { 
                flex: 0 0 50%; 
                width: 100%; 
                border-left: none; 
                border-top: 4px solid #ef4444;
            }

            #viz-container { flex: 1; }
            #image-view { flex: 1; }
            #3d-view { flex: 1.2; }

            #ori-container { transform: scale(0.8); left: 10px; bottom: 52%; }
        }

        /* ORI ASSISTANT */
        #ori-container {
            position: fixed;
            bottom: 30px;
            left: 30px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            pointer-events: none;
        }

        #ori-bubble {
            background: #fff;
            color: #020617;
            padding: 12px 18px;
            border-radius: 24px;
            font-size: 14px;
            font-weight: 800;
            margin-bottom: 12px;
            position: relative;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid #ef4444;
            pointer-events: auto;
            width: 250px;
        }

        #ori-bubble::after {
            content: ''; position: absolute; bottom: -15px; left: 50%;
            transform: translateX(-50%);
            border-left: 15px solid transparent; border-right: 15px solid transparent; border-top: 15px solid #ef4444;
        }

        #ori-quick-input {
            width: 100%; margin-top: 10px; padding: 10px;
            border-radius: 10px; border: 2px solid #cbd5e1;
            font-size: 14px; outline: none; background: #f8fafc;
        }

        #ori-avatar {
            width: 70px; height: 70px;
            background: #fff;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 25px rgba(239, 68, 68, 0.4);
            cursor: pointer; border: 4px solid #ef4444;
            overflow: hidden; pointer-events: auto;
        }

        #ori-avatar svg { width: 85%; height: 85%; }

        /* Welcome & Loading */
        #welcome-screen {
            position: absolute; inset: 0; background: #020617; z-index: 50;
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
            padding: 30px;
        }

        .quick-addresses { margin-top: 25px; display: grid; gap: 12px; width: 100%; max-width: 450px; }
        .addr-btn { 
            background: #1e293b; border: 2px solid #334155; color: #fff; 
            padding: 18px; border-radius: 15px; cursor: pointer; font-size: 18px; 
            transition: all 0.2s; text-align: center; font-weight: 800;
        }
        .addr-btn:hover { border-color: #ef4444; background: #0f172a; }

        #loading-screen {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.95); padding: 40px; border-radius: 24px;
            z-index: 200; display: none; color: #ef4444; font-weight: 800; border: 4px solid #ef4444; text-align: center;
        }

        .legend-icon { width: 12px; height: 12px; margin-left: 10px; border-radius: 3px; }
    </style>
    <script async src="https://cdn.jsdelivr.net/npm/es-module-shims@1.6.3/dist/es-module-shims.js"></script>
    <script type="importmap">
      {
        "imports": {
          "three": "https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.module.js",
          "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.150.1/examples/jsm/"
        }
      }
    </script>
</head>
<body>

    <div class="app-wrapper">
        <header>
            <div class="logo-box">
                <span>ğŸ›¡ï¸</span> FIRE-CORE v15
            </div>
            <div class="search-bar">
                <input id="addr-input" type="text" placeholder="×—×™×¤×•×© ×›×ª×•×‘×ª..." autofocus />
                <button id="search-btn" class="btn-search">××—×–×¨</button>
            </div>
        </header>

        <main>
            <!-- Welcome Screen -->
            <div id="welcome-screen">
                <div style="font-size: 80px; margin-bottom: 20px; filter: drop-shadow(0 0 20px #ef4444);">ğŸ </div>
                <h1 style="font-size: 32px; margin: 0; color: #ef4444; font-weight: 800;">××•×“×™×¢×™×Ÿ ××‘× ×™× ××¨×—×‘×™</h1>
                <p style="color: #94a3b8; font-size: 18px; margin-top: 10px;">×× ×•×¢ ×”× ×“×¡×™ ×’×œ×•×‘×œ×™ - ××™×¤×•×™ ×“×™×¨×•×ª ××“×•×™×§</p>
                <div class="quick-addresses">
                    <div class="addr-btn" onclick="quickSearch('×”×§×©×ª 3 × ×¡ ×¦×™×•× ×”')">ğŸ“ ×”×§×©×ª 3, × ×¡ ×¦×™×•× ×” (17 ×™×—"×“)</div>
                    <div class="addr-btn" onclick="quickSearch('×“×¨×š ×”×¤×¨×—×™× 9 ×’×“×¨×”')">ğŸ“ ×“×¨×š ×”×¤×¨×—×™× 9, ×’×“×¨×”</div>
                    <div class="addr-btn" onclick="quickSearch('×¢×•× ×•×ª ×”×©× ×” 5 × ×¡ ×¦×™×•× ×”')">ğŸ“ ×¢×•× ×•×ª ×”×©× ×” 5, × ×¡ ×¦×™×•× ×”</div>
                </div>
            </div>

            <div id="loading-screen">×× ×ª×— ×’×™××•××˜×¨×™×” ×•××‘× ×” ×“×™×¨×•×ª...</div>

            <!-- Sidebar Panel -->
            <aside id="info-sidebar">
                <h2 id="ui-title" style="margin:0 0 15px 0; color: #fff; font-size: 20px; font-weight: 800; border-bottom: 2px solid #ef4444; padding-bottom: 8px;">-</h2>
                
                <div class="section-header"><span>ğŸ§­</span> ×’×™×©×” ×•× ×™×•×•×˜</div>
                <div class="side-card">
                    <div class="data-point" id="ui-main-street">-</div>
                    <div class="data-point" id="ui-access">-</div>
                    <div class="data-point" id="ui-parking">-</div>
                </div>

                <div class="section-header"><span>ğŸ¢</span> ××¤×¨×˜ ×”× ×“×¡×™ ×•×“×™×¨×•×ª</div>
                <div class="side-card">
                    <div class="data-point" id="ui-total-units">-</div>
                    <div class="data-point" id="ui-floors">-</div>
                    <div class="data-point" id="ui-garden">-</div>
                    <div class="data-point" id="ui-penthouse">-</div>
                </div>

                <div class="section-header"><span>âš ï¸</span> ×”×ª×¨××•×ª ××‘×¦×¢×™×•×ª</div>
                <div class="alert-box" id="ui-alert">-</div>
                
                <div style="margin-top: 30px; font-size: 12px; color: #94a3b8; padding-bottom: 40px;">
                    <div style="display:flex; align-items:center; margin-bottom:8px;"><div class="legend-icon" style="background:#ef4444"></div> ×œ×™×‘×” (××"×“×™× / ××¢×œ×™×ª)</div>
                    <div style="display:flex; align-items:center; margin-bottom:8px;"><div class="legend-icon" style="background:#10b981"></div> ×§×•××ª ×’×Ÿ (×§×•××” 0)</div>
                    <div style="display:flex; align-items:center; margin-bottom:8px;"><div class="legend-icon" style="background:#f59e0b"></div> ×¤× ×˜×”××•×–×™× (×§×•××” ×¢×œ×™×•× ×”)</div>
                </div>
            </aside>

            <!-- Visualization Content -->
            <div id="viz-container">
                <div id="3d-view">
                    <div id="mini-map"></div>
                </div>
                <div id="image-view">
                    <div style="color: #64748b; position: absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size: 15px; font-weight: 700;">×˜×•×¢×Ÿ ×ª×¦×•×’×ª ××‘× ×” ×××ª×™×ª...</div>
                </div>
            </div>

            <!-- ORI ASSISTANT ROBOT -->
            <div id="ori-container">
                <div id="ori-bubble">
                    <div class="bubble-text">×©×œ×•× ×× ×™ ××•×¨×™, ×¢×•×–×¨ ×•×§×”"× , ×œ×›×œ ×©××œ×” ×× ×™ ×œ×¨×©×•×ª×š..</div>
                    <input type="text" id="ori-quick-input" placeholder="×©××œ ××•×ª×™ ×¢×œ ×”×‘× ×™×™×Ÿ..." />
                </div>
                <div id="ori-avatar">
                    <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="100" cy="100" r="95" fill="#fff" stroke="#ef4444" stroke-width="4"/>
                        <rect x="50" y="50" width="100" height="70" rx="15" fill="#ef4444"/>
                        <rect x="65" y="65" width="70" height="30" rx="5" fill="#111827"/>
                        <circle cx="85" cy="80" r="6" fill="#00ffff"><animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/></circle>
                        <circle cx="115" cy="80" r="6" fill="#00ffff"><animate attributeName="opacity" values="1;0.3;1" dur="2s" repeatCount="indefinite"/></circle>
                        <path d="M70 120 L130 120 L120 170 L80 170 Z" fill="#ef4444"/>
                        <circle cx="100" cy="145" r="12" fill="#fbbf24"/>
                        <text x="100" y="150" font-size="8" text-anchor="middle" font-weight="bold" fill="#000">FIRE</text>
                    </svg>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, controls, model;
        let currentBuildingData = null;

        const database = {
            "×”×§×©×ª 3 × ×¡ ×¦×™×•× ×”": {
                name: "×”×§×©×ª 3, × ×¡ ×¦×™×•× ×”",
                mainStreet: "×¨×—×•×‘ ×”×©×¨×™×•×Ÿ",
                access: "×’×™×©×” ××¨×—×•×‘ ×”×§×©×ª (×œ×œ× ××•×¦×).",
                parking: "×§×•××ª ×¢××•×“×™× ××¤×œ×¡ 0.",
                totalUnits: "17 ×™×—×™×“×•×ª ×“×™×•×¨",
                floors: 6,
                garden: "2 ×“×™×¨×•×ª ×’×Ÿ (×§×•××” 0 - ×’×•×‘×” ×§×¨×§×¢).",
                penthouse: "2 ×¤× ×˜×”××•×–×™× ×‘×§×•××” 6.",
                infra: "××™×: ×—×–×™×ª ×©×××œ. ×—×©××œ: × ×™×©×” ×™×× ×™×ª.",
                alert: "×¨×—×•×‘ ×œ×œ× ××•×¦×! ×× ×•×£ ×’×‘×”×™× ×—×™×™×‘ ×œ×”×™×›× ×¡ ×‘× ×¡×™×¢×” ×œ××—×•×¨.",
                lat: 31.9269502, lng: 34.8121877,
                sv_embed: "https://www.google.com/maps/embed?pb=!1m0!4v1705660000000!6m8!1m7!1ss_umpcog4UlLmpx7U8wv_Q!2m2!1d31.9269502!2d34.8121877!3f322.76!4f11.59!5f0.78",
                cfg: { w: 18, d: 15, floors: 6, h: 3.2, 
                    units: [
                        {floor: 0, label: "×’×Ÿ 01", type: 'garden', pos: [5, 4]},
                        {floor: 0, label: "×’×Ÿ 02", type: 'garden', pos: [-5, 4]},
                        {floor: 1, label: "×“×™×¨×” 11", type: 'standard', pos: [5, 0]},
                        {floor: 2, label: "×“×™×¨×” 21", type: 'standard', pos: [5, 0]},
                        {floor: 3, label: "×“×™×¨×” 31", type: 'standard', pos: [5, 0]},
                        {floor: 4, label: "×“×™×¨×” 41", type: 'standard', pos: [5, 0]},
                        {floor: 5, label: "×“×™×¨×” 51", type: 'standard', pos: [5, 0]},
                        {floor: 6, label: "×¤× ×˜' 601", type: 'penthouse', pos: [4, 0]},
                        {floor: 6, label: "×¤× ×˜' 602", type: 'penthouse', pos: [-4, 0]}
                    ]
                }
            },
            "×“×¨×š ×”×¤×¨×—×™× 9 ×’×“×¨×”": {
                name: "×“×¨×š ×”×¤×¨×—×™× 9, ×’×“×¨×”",
                mainStreet: "×›×‘×™×© 40 / ×”×¨×¦×œ",
                access: "×›× ×™×¡×” ××“×¨×š ×”×¤×¨×—×™×.",
                parking: "×—× ×™×•×Ÿ ×ª×ª-×§×¨×§×¢×™ (××¤×œ×¡ -1).",
                totalUnits: "28 ×™×—×™×“×•×ª ×“×™×•×¨",
                floors: 8,
                garden: "4 ×“×™×¨×•×ª ×’×Ÿ ×‘×§×•××” 0.",
                penthouse: "2 ×¤× ×˜×”××•×–×™× ×‘×§×•××” 8.",
                infra: "××™×: ×—×–×™×ª ×™××™×Ÿ. ×—×©××œ: ×œ×•×‘×™ ×¢×•×¨×£.",
                alert: "×—× ×™×•×Ÿ ×¤×¢×™×œ - ×¡×›× ×ª ×¢×©×Ÿ ×‘××™× ×•×¡ 1.",
                lat: 31.8123, lng: 34.7812,
                sv_embed: "https://www.google.com/maps/embed?pb=!1m0!4v1705660000000!6m8!1m7!1s-u_y5f4hO4vH7rG-S4_mOQ!2m2!1d31.8123!2d34.7812!3f180!4f10!5f0.78",
                cfg: { w: 22, d: 18, floors: 8, h: 3.1, 
                    units: [
                        {floor: 0, label: "×’×Ÿ 1", type: 'garden', pos: [7, 6]},
                        {floor: 8, label: "×¤× ×˜' 801", type: 'penthouse', pos: [6, 0]}
                    ]
                }
            }
        };

        function normalize(str) { return str.replace(/[ ,.\-]/g, '').trim(); }

        window.initThree = function() {
            if (renderer) return;
            const container = document.getElementById('3d-view');
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(35, container.clientWidth / container.clientHeight, 0.1, 2000);
            camera.position.set(120, 100, 120);

            const isMobile = window.innerWidth <= 768;
            renderer = new THREE.WebGLRenderer({ 
                antialias: true, 
                alpha: true, 
                powerPreference: 'high-performance' 
            });
            
            renderer.setSize(container.clientWidth, container.clientHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            container.appendChild(renderer.domElement);

            controls = new OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            scene.add(new THREE.AmbientLight(0xffffff, 0.6));
            const sun = new THREE.DirectionalLight(0xffffff, 1.2);
            sun.position.set(50, 200, 50);
            scene.add(sun);

            model = new THREE.Group();
            scene.add(model);
            animate();
        };

        function animate() {
            if (!renderer) return;
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }

        function createLabel(text, pos, isUnit = false) {
            const isMobile = window.innerWidth <= 768;
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = 320; canvas.height = 100;
            
            if(isUnit) {
                ctx.fillStyle = 'rgba(15, 23, 42, 0.95)';
                ctx.beginPath(); ctx.roundRect(10, 10, 300, 80, 12); ctx.fill();
                ctx.strokeStyle = '#ef4444'; ctx.lineWidth = 3; ctx.stroke();
                ctx.fillStyle = '#fff'; ctx.font = `Bold ${isMobile ? '30px' : '22px'} Assistant`;
            } else {
                ctx.fillStyle = '#fff'; ctx.font = `Bold ${isMobile ? '34px' : '26px'} Assistant`;
            }
            
            ctx.textAlign = 'center';
            ctx.fillText(text, 160, 60);
            
            const texture = new THREE.CanvasTexture(canvas);
            const sprite = new THREE.Sprite(new THREE.SpriteMaterial({ map: texture, transparent: true }));
            sprite.position.set(pos[0], pos[1], pos[2]);
            sprite.scale.set(isUnit ? 12 : 18, isUnit ? 4 : 6, 1);
            return sprite;
        }

        function buildModel(data) {
            model.clear();
            const c = data.cfg;
            const tH = (c.floors + 1) * c.h;

            model.add(new THREE.GridHelper(600, 30, 0x334155, 0x1e293b));

            // Core
            const core = new THREE.Mesh(
                new THREE.BoxGeometry(6, tH, 6),
                new THREE.MeshPhongMaterial({ color: 0xef4444, transparent: true, opacity: 0.8 })
            );
            core.position.y = tH / 2;
            model.add(core);

            // Floors - Unified Logic (Floor 0 is ground)
            for(let i=0; i<=c.floors; i++) {
                const floor = new THREE.Mesh(
                    new THREE.BoxGeometry(c.w, 0.1, c.d),
                    new THREE.MeshPhongMaterial({ color: 0x64748b, transparent: true, opacity: 0.3 })
                );
                floor.position.y = i * c.h;
                model.add(floor);
                model.add(createLabel(`×§×•××” ${i}`, [c.w/2 + 12, i * c.h, 0]));
            }

            // Apartments - Unified Logic
            if(c.units) c.units.forEach(u => {
                let color = u.type === 'garden' ? 0x10b981 : (u.type === 'penthouse' ? 0xf59e0b : 0xffffff);
                const unitGeo = new THREE.BoxGeometry(c.w/2.5, c.h * 0.95, c.d/2.5);
                const unit = new THREE.Mesh(unitGeo, new THREE.MeshPhongMaterial({ color: color, transparent: true, opacity: 0.45 }));
                
                // Position logic: always relative to floor height
                unit.position.set(u.pos[0], (u.floor * c.h) + (c.h/2), u.pos[1]);
                model.add(unit);

                const line = new THREE.LineSegments(new THREE.EdgesGeometry(unitGeo), new THREE.LineBasicMaterial({ color: color, opacity: 1 }));
                line.position.copy(unit.position); model.add(line);
                
                model.add(createLabel(u.label, [u.pos[0], (u.floor * c.h) + c.h + 0.5, u.pos[1]], true));
            });

            camera.position.set(c.w*4, tH*2.5, c.d*4);
            controls.target.set(0, tH/3, 0);
            controls.update();
        }

        window.quickSearch = function(addr) { 
            document.getElementById('addr-input').value = addr;
            performSearch(); 
        };

        function performSearch() {
            const query = document.getElementById('addr-input').value.trim();
            if(!query) return;
            const welcome = document.getElementById('welcome-screen');
            const loader = document.getElementById('loading-screen');
            const sidebar = document.getElementById('info-sidebar');
            const miniMap = document.getElementById('mini-map');
            const iv = document.getElementById('image-view');
            
            welcome.style.display = 'none'; loader.style.display = 'block'; sidebar.style.display = 'none'; miniMap.style.display = 'none';

            const normQ = normalize(query);
            let data = null;
            for (let key in database) { if (normalize(key).includes(normQ) || normQ.includes(normalize(key))) { data = database[key]; break; } }

            // Automatic Generation Protocol (Unified Logic)
            if (!data) {
                data = { 
                    name: query, mainStreet: "×œ× ×™×“×•×¢", access: "×¡×¨×™×§×” ×‘×©×˜×—", parking: "×¡×¨×™×§×” ×‘×©×˜×—", totalUnits: "× ×™×ª×•×— ××©×•×¢×¨", floors: 5, garden: "×§×•××ª ×§×¨×§×¢ (×§×•××” 0)", penthouse: "×§×•××” 5", infra: "×œ× ×™×“×•×¢", alert: "×‘×¦×¢ ×¡×¨×™×§×” ××œ××”", lat: 31.9, lng: 34.8, sv_embed: "", 
                    cfg: { w: 18, d: 15, floors: 5, h: 3.2, units: [
                        {floor: 0, label: "×“×™×¨×ª ×’×Ÿ", type: 'garden', pos: [5, 4]},
                        {floor: 5, label: "×¤× ×˜×”××•×–", type: 'penthouse', pos: [4, 0]}
                    ] } 
                };
            }

            setTimeout(() => {
                currentBuildingData = data;
                document.getElementById('ui-title').innerText = data.name;
                document.getElementById('ui-main-street').innerHTML = `<b>×¦×™×¨ ×”×’×¢×”:</b> ${data.mainStreet}`;
                document.getElementById('ui-access').innerHTML = `<b>×’×™×©×”:</b> ${data.access}`;
                document.getElementById('ui-parking').innerHTML = `<b>×—× ×™×™×”:</b> ${data.parking}`;
                document.getElementById('ui-total-units').innerHTML = `<b>×¡×”"×› ×“×™×¨×•×ª:</b> ${data.totalUnits}`;
                document.getElementById('ui-floors').innerHTML = `<b>×§×•××•×ª:</b> ${data.floors}`;
                document.getElementById('ui-garden').innerHTML = `<b>×“×™×¨×•×ª ×’×Ÿ:</b> ${data.garden}`;
                document.getElementById('ui-penthouse').innerHTML = `<b>×¤× ×˜×”××•×–:</b> ${data.penthouse}`;
                document.getElementById('ui-infra').innerHTML = `<b>×ª×©×ª×™×•×ª:</b> ${data.infra || "×œ× ×××•×¤×”"}`;
                document.getElementById('ui-alert').innerText = data.alert;

                miniMap.innerHTML = `<iframe src="https://maps.google.com/maps?q=${data.lat},${data.lng}&t=&z=17&ie=UTF8&iwloc=&output=embed" allowfullscreen></iframe>`;
                miniMap.style.display = 'block';

                iv.innerHTML = `<iframe src="${data.sv_embed || `https://www.google.com/maps?q=${encodeURIComponent(data.name)}&output=embed&layer=c`}" allowfullscreen></iframe>`;

                if (!renderer) window.initThree();
                buildModel(data);
                loader.style.display = 'none'; sidebar.style.display = 'flex';
                onResize();
            }, 700);
        }

        document.getElementById('search-btn').onclick = performSearch;
        document.getElementById('addr-input').onkeypress = (e) => { if (e.key === 'Enter') performSearch(); };

        function onResize() {
            if (!renderer) return;
            const container = document.getElementById('3d-view');
            camera.aspect = container.clientWidth / container.clientHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(container.clientWidth, container.clientHeight);
        }
        window.addEventListener('resize', onResize);
        window.onload = () => { setTimeout(window.initThree, 200); };
    </script>
</body>
</html>
